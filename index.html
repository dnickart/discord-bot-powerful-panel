<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Панель Бота</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .card { transition: 0.3s; }
    .card:hover { transform: scale(1.02); }
  </style>
</head>
<body>
  <div class="container mt-5">
    <div class="text-center mb-4">
      <h1>Панель Discord Бота</h1>
      <button id="login-btn" class="btn btn-primary btn-lg">Увійти через Discord</button>
      <button id="logout-btn" class="btn btn-danger btn-sm d-none">Вийти</button>
    </div>

    <div id="dashboard" class="d-none">
      <h3>Ваші сервери</h3>
      <div id="servers" class="row"></div>
    </div>
  </div>

  <script>
    const API_URL = 'https://your-bot-api.onrender.com'; // ← ЗМІНИТИ!
    const CLIENT_ID = '123456789012345678'; // ← ЗМІНИТИ!

    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');

    if (code) {
      fetch(`${API_URL}/auth?code=${code}`)
        .then(r => r.json())
        .then(data => {
          localStorage.setItem('token', data.access_token);
          window.history.replaceState({}, document.title, "/");
          loadDashboard();
        });
    }

    document.getElementById('login-btn').onclick = () => {
      const redirect = `http://localhost:5000`; // або ваш GitHub Pages URL
      window.location = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(redirect)}&response_type=code&scope=identify%20guilds`;
    };

    document.getElementById('logout-btn').onclick = () => {
      localStorage.removeItem('token');
      location.reload();
    };

    function loadDashboard() {
      const token = localStorage.getItem('token');
      if (!token) return;

      fetch(`${API_URL}/dashboard`, {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(r => r.json())
      .then(data => {
        document.getElementById('login-btn').classList.add('d-none');
        document.getElementById('logout-btn').classList.remove('d-none');
        document.getElementById('dashboard').classList.remove('d-none');

        const serversDiv = document.getElementById('servers');
        serversDiv.innerHTML = '';
        data.guilds.forEach(g => {
          const card = `
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <h5>${g.name}</h5>
                  <button onclick="viewServer(${g.id})" class="btn btn-sm btn-success">Переглянути</button>
                </div>
              </div>
            </div>`;
          serversDiv.innerHTML += card;
        });
      });
    }

    function viewServer(guildId) {
      const token = localStorage.getItem('token');
      fetch(`${API_URL}/server/${guildId}`, {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(r => r.json())
      .then(data => {
        alert(`Префікс: ${data.prefix}\nВітання: ${data.welcome_enabled ? 'Увімкнено' : 'Вимкнено'}`);
      });
    }

    if (localStorage.getItem('token')) loadDashboard();
  </script>
</body>
</html>
